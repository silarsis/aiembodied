
> aiembodied@0.0.1 test C:\Users\kevin\repos\aiembodied
> pnpm -r test

Scope: 2 of 3 workspace projects
app/main test$ npm run test:rebuild && node scripts/test-split.mjs
app/renderer test$ vitest run
app/main test: > @aiembodied/main@0.0.1 test:rebuild
app/main test: > node scripts/test-rebuild.mjs
app/renderer test: [1m[43m DEPRECATED [49m[22m [33m"environmentMatchGlobs" is deprecated. Use `test.projects` to define different configurations instead.[39m
app/renderer test: [1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/kevin/repos/aiembodied/app/renderer[39m
app/main test: .../node_modules/better-sqlite3 install$ prebuild-install || node-gyp rebuild --release
app/main test: .../node_modules/better-sqlite3 install: prebuild-install warn install EBUSY: resource busy or locked, open 'C:\Users\kevin\repos\aiembodied\node_modules\.pnpm\better-sqlite3@12.5.0\node_modules\better-sqlite3\build\Release\better_sqlite3.node'
app/main test: .../node_modules/better-sqlite3 install: gyp info it worked if it ends with ok
app/main test: .../node_modules/better-sqlite3 install: gyp info using node-gyp@11.5.0
app/main test: .../node_modules/better-sqlite3 install: gyp info using node@22.21.0 | win32 | x64
app/renderer test:  [32mÎ“Â£Ã´[39m tests/realtime/realtime-client.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 53[2mms[22m[39m
app/renderer test:  [32mÎ“Â£Ã´[39m tests/avatar/idle-scheduler.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 30[2mms[22m[39m
app/renderer test: [90mstderr[2m | tests/avatar/vrm-avatar-renderer.test.tsx[2m > [22m[2mcreateRightArmWaveClip[2m > [22m[2mreturns null when humanoid mapping is missing
app/renderer test: [22m[39m[vrm-avatar-renderer] VRM humanoid is unavailable; cannot create wave animation clip.
app/renderer test: [90mstderr[2m | tests/avatar/vrm-avatar-renderer.test.tsx[2m > [22m[2msuppressOutlierMeshes[2m > [22m[2mhides meshes that exceed the max world-space size
app/renderer test: [22m[39m[vrm-avatar-renderer] Hiding oversized mesh { name: [32m''[39m, maxDim: [33m200[39m }
app/renderer test: [90mstdout[2m | tests/avatar/vrm-avatar-renderer.test.tsx[2m > [22m[2mVrmAvatarRenderer behavior cues[2m > [22m[2mplays a wave animation when a greet_face cue is emitted
app/renderer test: [22m[39m[vrm-avatar-renderer] T-pose detection result: [33mfalse[39m
app/renderer test: [vrm-avatar-renderer] Model not in T-pose, skipping relaxed pose adjustment
app/renderer test: [vrm-avatar-renderer] VRM scene metrics {"modelId":"vrm-1","meshCount":0,"skinnedMeshCount":0,"hiddenMeshes":0,"bounds":null,"head":null}
app/renderer test: [90mstderr[2m | tests/avatar/vrm-avatar-renderer.test.tsx[2m > [22m[2mVrmAvatarRenderer behavior cues[2m > [22m[2mplays a wave animation when a greet_face cue is emitted
app/renderer test: [22m[39m[vrm-avatar-renderer] Pose API unavailable, skipping default pose save
app/renderer test: [90mstdout[2m | tests/avatar/vrm-avatar-renderer.test.tsx[2m > [22m[2mVrmAvatarRenderer behavior cues[2m > [22m[2mplays a wave animation when a greet_face cue is emitted
app/renderer test: [22m[39m[vrm-avatar-renderer] greet_face cue triggered wave animation. { source: [32m'camera'[39m }
app/renderer test:  [32mÎ“Â£Ã´[39m tests/avatar/vrm-avatar-renderer.test.tsx [2m([22m[2m9 tests[22m[2m)[22m[32m 176[2mms[22m[39m
app/renderer test: [90mstdout[2m | tests/avatar/vrm-animation-queue.test.tsx[2m > [22m[2mVrmAvatarRenderer animation queue[2m > [22m[2mqueues animations sequentially
app/renderer test: [22m[39m[vrm-avatar-renderer] T-pose detection result: [33mfalse[39m
app/renderer test: [vrm-avatar-renderer] Model not in T-pose, skipping relaxed pose adjustment
app/renderer test: [vrm-avatar-renderer] VRM scene metrics {"modelId":"vrm-1","meshCount":0,"skinnedMeshCount":0,"hiddenMeshes":0,"bounds":null,"head":null}
app/renderer test: [90mstderr[2m | tests/avatar/vrm-animation-queue.test.tsx[2m > [22m[2mVrmAvatarRenderer animation queue[2m > [22m[2mqueues animations sequentially
app/renderer test: [22m[39m[vrm-avatar-renderer] Pose API unavailable, skipping default pose save
app/renderer test: [90mstderr[2m | tests/avatar/vrm-animation-queue.test.tsx[2m > [22m[2mVrmAvatarRenderer animation queue[2m > [22m[2mqueues animations sequentially
app/renderer test: [22m[39m[vrm-avatar-renderer] Missing right arm bones; skipping wave animation setup.
app/renderer test: [90mstderr[2m | tests/avatar/avatar-renderers.smoke.test.tsx[2m > [22m[2mavatar renderer smoke tests[2m > [22m[2mmounts the VRM renderer when a model is available
app/renderer test: [22m[39m[vrm-avatar-renderer] failed to load VRM model TypeError: chestWorldPos.sub is not a function
app/renderer test:     at isInTPose [90m(C:\Users\kevin\repos\aiembodied\app\renderer\[39msrc\avatar\vrm-avatar-renderer.tsx:637:34[90m)[39m
app/renderer test:     at applyRelaxedPose [90m(C:\Users\kevin\repos\aiembodied\app\renderer\[39msrc\avatar\vrm-avatar-renderer.tsx:786:19[90m)[39m
app/renderer test:     at load [90m(C:\Users\kevin\repos\aiembodied\app\renderer\[39msrc\avatar\vrm-avatar-renderer.tsx:1749:9[90m)[39m
app/renderer test: [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
app/renderer test: [90mstderr[2m | tests/avatar/avatar-renderers.smoke.test.tsx[2m > [22m[2mavatar renderer smoke tests[2m > [22m[2mloads the VRM model binary when the component mounts
app/renderer test: [22m[39m[vrm-avatar-renderer] failed to load VRM model TypeError: chestWorldPos.sub is not a function
app/renderer test:     at isInTPose [90m(C:\Users\kevin\repos\aiembodied\app\renderer\[39msrc\avatar\vrm-avatar-renderer.tsx:637:34[90m)[39m
app/renderer test:     at applyRelaxedPose [90m(C:\Users\kevin\repos\aiembodied\app\renderer\[39msrc\avatar\vrm-avatar-renderer.tsx:786:19[90m)[39m
app/renderer test:     at load [90m(C:\Users\kevin\repos\aiembodied\app\renderer\[39msrc\avatar\vrm-avatar-renderer.tsx:1749:9[90m)[39m
app/renderer test:  [32mÎ“Â£Ã´[39m tests/avatar/avatar-renderers.smoke.test.tsx [2m([22m[2m2 tests[22m[2m)[22m[33m 869[2mms[22m[39m
app/renderer test: [90mstdout[2m | tests/avatar/vrm-animation-queue.test.tsx[2m > [22m[2mVrmAvatarRenderer animation queue[2m > [22m[2minvokes timing callbacks when starting playback
app/renderer test: [22m[39m[vrm-avatar-renderer] T-pose detection result: [33mfalse[39m
app/renderer test: [vrm-avatar-renderer] Model not in T-pose, skipping relaxed pose adjustment
app/renderer test: [vrm-avatar-renderer] VRM scene metrics {"modelId":"vrm-1","meshCount":0,"skinnedMeshCount":0,"hiddenMeshes":0,"bounds":null,"head":null}
app/renderer test: [90mstderr[2m | tests/avatar/vrm-animation-queue.test.tsx[2m > [22m[2mVrmAvatarRenderer animation queue[2m > [22m[2minvokes timing callbacks when starting playback
app/renderer test: [22m[39m[vrm-avatar-renderer] Pose API unavailable, skipping default pose save
app/renderer test: [90mstderr[2m | tests/avatar/vrm-animation-queue.test.tsx[2m > [22m[2mVrmAvatarRenderer animation queue[2m > [22m[2minvokes timing callbacks when starting playback
app/renderer test: [22m[39m[vrm-avatar-renderer] Missing right arm bones; skipping wave animation setup.
app/renderer test: [90mstdout[2m | tests/avatar/avatar-configurator.test.tsx[2m > [22m[2mAvatarConfigurator[2m > [22m[2msubmits a VRMA prompt and reports success
app/renderer test: [22m[39m[avatar configurator] Avatar bridge connected.
app/renderer test: [90mstdout[2m | tests/avatar/vrm-animation-queue.test.tsx[2m > [22m[2mVrmAvatarRenderer animation queue[2m > [22m[2mholds pose animations on the final frame
app/renderer test: [22m[39m[vrm-avatar-renderer] T-pose detection result: [33mfalse[39m
app/renderer test: [vrm-avatar-renderer] Model not in T-pose, skipping relaxed pose adjustment
app/renderer test: [vrm-avatar-renderer] VRM scene metrics {"modelId":"vrm-1","meshCount":0,"skinnedMeshCount":0,"hiddenMeshes":0,"bounds":null,"head":null}
app/renderer test: [90mstderr[2m | tests/avatar/vrm-animation-queue.test.tsx[2m > [22m[2mVrmAvatarRenderer animation queue[2m > [22m[2mholds pose animations on the final frame
app/renderer test: [22m[39m[vrm-avatar-renderer] Pose API unavailable, skipping default pose save
app/renderer test: [90mstderr[2m | tests/avatar/vrm-animation-queue.test.tsx[2m > [22m[2mVrmAvatarRenderer animation queue[2m > [22m[2mholds pose animations on the final frame
app/renderer test: [22m[39m[vrm-avatar-renderer] Missing right arm bones; skipping wave animation setup.
app/renderer test: [90mstdout[2m | tests/avatar/vrm-animation-queue.test.tsx[2m > [22m[2mVrmAvatarRenderer animation queue[2m > [22m[2mlooks up clips by slug name
app/renderer test: [22m[39m[vrm-avatar-renderer] T-pose detection result: [33mfalse[39m
app/renderer test: [vrm-avatar-renderer] Model not in T-pose, skipping relaxed pose adjustment
app/renderer test: [vrm-avatar-renderer] VRM scene metrics {"modelId":"vrm-1","meshCount":0,"skinnedMeshCount":0,"hiddenMeshes":0,"bounds":null,"head":null}
app/renderer test: [90mstderr[2m | tests/avatar/vrm-animation-queue.test.tsx[2m > [22m[2mVrmAvatarRenderer animation queue[2m > [22m[2mlooks up clips by slug name
app/renderer test: [22m[39m[vrm-avatar-renderer] Pose API unavailable, skipping default pose save
app/renderer test: [90mstderr[2m | tests/avatar/vrm-animation-queue.test.tsx[2m > [22m[2mVrmAvatarRenderer animation queue[2m > [22m[2mlooks up clips by slug name
app/renderer test: [22m[39m[vrm-avatar-renderer] Missing right arm bones; skipping wave animation setup.
app/renderer test:  [32mÎ“Â£Ã´[39m tests/avatar/vrm-animation-queue.test.tsx [2m([22m[2m4 tests[22m[2m)[22m[33m 522[2mms[22m[39m
app/renderer test: [90mstdout[2m | tests/avatar/avatar-configurator.test.tsx[2m > [22m[2mAvatarConfigurator[2m > [22m[2mrenders VRM models with metadata and handles activation and deletion
app/renderer test: [22m[39m[avatar configurator] Avatar bridge connected.
app/renderer test: [90mstderr[2m | tests/avatar/avatar-configurator.test.tsx[2m > [22m[2mAvatarConfigurator[2m > [22m[2mrenders VRM models with metadata and handles activation and deletion
app/renderer test: [22m[39mNot implemented: HTMLCanvasElement's getContext() method: without installing the canvas npm package
app/renderer test: Not implemented: HTMLCanvasElement's getContext() method: without installing the canvas npm package
app/renderer test: THREE.WebGLRenderer: Error creating WebGL context.
app/renderer test: [90mstderr[2m | tests/avatar/avatar-configurator.test.tsx[2m > [22m[2mAvatarConfigurator[2m > [22m[2mrenders VRM models with metadata and handles activation and deletion
app/renderer test: [22m[39m[avatar-configurator] Failed to generate thumbnail for model vrm-2: Error: Error creating WebGL context.
app/renderer test:     at new WebGLRenderer (file:///C:/Users/kevin/repos/aiembodied/node_modules/[4m.pnpm[24m/three@0.182.0/node_modules/[4mthree[24m/build/three.module.js:15921:13)
app/renderer test:     at createOffscreenRenderer [90m(C:\Users\kevin\repos\aiembodied\app\renderer\[39msrc\avatar\thumbnail-generator.ts:21:20[90m)[39m
app/renderer test:     at generateVrmThumbnail [90m(C:\Users\kevin\repos\aiembodied\app\renderer\[39msrc\avatar\thumbnail-generator.ts:114:20[90m)[39m
app/renderer test:     at [90mC:\Users\kevin\repos\aiembodied\app\renderer\[39msrc\avatar\avatar-configurator.tsx:162:39
app/renderer test: [90mstderr[2m | tests/avatar/avatar-configurator.test.tsx[2m > [22m[2mAvatarConfigurator[2m > [22m[2mrenders VRM models with metadata and handles activation and deletion
app/renderer test: [22m[39mNot implemented: HTMLCanvasElement's getContext() method: without installing the canvas npm package
app/renderer test: Not implemented: HTMLCanvasElement's getContext() method: without installing the canvas npm package
app/renderer test: THREE.WebGLRenderer: Error creating WebGL context.
app/renderer test: [90mstderr[2m | tests/avatar/avatar-configurator.test.tsx[2m > [22m[2mAvatarConfigurator[2m > [22m[2mrenders VRM models with metadata and handles activation and deletion
app/renderer test: [22m[39m[avatar-configurator] Failed to generate thumbnail for model vrm-2: Error: Error creating WebGL context.
app/renderer test:     at new WebGLRenderer (file:///C:/Users/kevin/repos/aiembodied/node_modules/[4m.pnpm[24m/three@0.182.0/node_modules/[4mthree[24m/build/three.module.js:15921:13)
app/renderer test:     at createOffscreenRenderer [90m(C:\Users\kevin\repos\aiembodied\app\renderer\[39msrc\avatar\thumbnail-generator.ts:21:20[90m)[39m
app/renderer test:     at generateVrmThumbnail [90m(C:\Users\kevin\repos\aiembodied\app\renderer\[39msrc\avatar\thumbnail-generator.ts:114:20[90m)[39m
app/renderer test:     at [90mC:\Users\kevin\repos\aiembodied\app\renderer\[39msrc\avatar\avatar-configurator.tsx:162:39
app/renderer test: [90mstdout[2m | tests/avatar/avatar-configurator.test.tsx[2m > [22m[2mAvatarConfigurator[2m > [22m[2muploads a VRM file and surfaces metadata from the main service
app/renderer test: [22m[39m[avatar configurator] Avatar bridge connected.
app/renderer test: [90mstdout[2m | tests/avatar/avatar-configurator.test.tsx[2m > [22m[2mAvatarConfigurator[2m > [22m[2mprevents non-vrm uploads and shows validation error
app/renderer test: [22m[39m[avatar configurator] Avatar bridge connected.
app/renderer test:  [32mÎ“Â£Ã´[39m tests/avatar/avatar-configurator.test.tsx [2m([22m[2m6 tests[22m[2m)[22m[33m 1993[2mms[22m[39m
app/renderer test:    [33m[2mÎ“Â£Ã´[22m[39m AvatarConfigurator[2m > [22msubmits a VRMA prompt and reports success [33m 754[2mms[22m[39m
app/renderer test:    [33m[2mÎ“Â£Ã´[22m[39m AvatarConfigurator[2m > [22mrenders VRM models with metadata and handles activation and deletion [33m 682[2mms[22m[39m
app/renderer test:  [32mÎ“Â£Ã´[39m tests/vite-config.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 6[2mms[22m[39m
app/renderer test:  [32mÎ“Â£Ã´[39m tests/audio/viseme-driver.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 17[2mms[22m[39m
app/renderer test:  [32mÎ“Â£Ã´[39m tests/audio/vad-controller.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 10[2mms[22m[39m
app/renderer test:  [32mÎ“Â£Ã´[39m tests/metrics/latency-tracker.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 9[2mms[22m[39m
app/renderer test:  [32mÎ“Â£Ã´[39m tests/avatar/animation-tags.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 8[2mms[22m[39m
app/renderer test:  [32mÎ“Â£Ã´[39m tests/audio/metrics.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 7[2mms[22m[39m
app/main test: .../node_modules/better-sqlite3 install: gyp ERR! clean error 
app/main test: .../node_modules/better-sqlite3 install: gyp ERR! stack Error: EPERM: operation not permitted, unlink 'C:\Users\kevin\repos\aiembodied\node_modules\.pnpm\better-sqlite3@12.5.0\node_modules\better-sqlite3\build\Release\better_sqlite3.node'
app/main test: .../node_modules/better-sqlite3 install: gyp ERR! System Windows_NT 10.0.26220
app/main test: .../node_modules/better-sqlite3 install: gyp ERR! command "C:\\Program Files\\nodejs\\node.exe" "C:\\Users\\kevin\\repos\\aiembodied\\node_modules\\.pnpm\\node_modules\\node-gyp\\bin\\node-gyp.js" "rebuild" "--release"
app/main test: .../node_modules/better-sqlite3 install: gyp ERR! cwd C:\Users\kevin\repos\aiembodied\node_modules\.pnpm\better-sqlite3@12.5.0\node_modules\better-sqlite3
app/main test: .../node_modules/better-sqlite3 install: gyp ERR! node -v v22.21.0
app/main test: .../node_modules/better-sqlite3 install: gyp ERR! node-gyp -v v11.5.0
app/main test: .../node_modules/better-sqlite3 install: gyp ERR! not ok 
app/main test: .../node_modules/better-sqlite3 install: Failed
app/main test: Î“Ã‡Ã«ELIFECYCLEÎ“Ã‡Ã« Command failed with exit code 1.
app/renderer test: [90mstdout[2m | tests/App.test.tsx[2m > [22m[2mApp component[2m > [22m[2mlogs realtime disconnect and reconnect when voice preference changes
app/renderer test: [22m[39m[RealtimeClient] Minted ephemeral token. { reason: [32m'connect'[39m }
app/renderer test:  [32mÎ“Â£Ã´[39m tests/App.test.tsx [2m([22m[2m16 tests[22m[2m)[22m[33m 9616[2mms[22m[39m
app/renderer test:    [33m[2mÎ“Â£Ã´[22m[39m App component[2m > [22mrenders tab navigation and toggles panels [33m 2002[2mms[22m[39m
app/renderer test:    [33m[2mÎ“Â£Ã´[22m[39m App component[2m > [22mcharacter tab loads the avatar configurator when active [33m 395[2mms[22m[39m
app/renderer test:    [33m[2mÎ“Â£Ã´[22m[39m App component[2m > [22mrenders the static realtime voice list without querying the API [33m 458[2mms[22m[39m
app/renderer test:    [33m[2mÎ“Â£Ã´[22m[39m App component[2m > [22mextends voice options with config and server supplied voices [33m 563[2mms[22m[39m
app/renderer test:    [33m[2mÎ“Â£Ã´[22m[39m App component[2m > [22mstages realtime session config with prompt before connecting [33m 364[2mms[22m[39m
app/renderer test:    [33m[2mÎ“Â£Ã´[22m[39m App component[2m > [22mrenders kiosk UI, toggles transcript overlay, and persists device preferences [33m 1003[2mms[22m[39m
app/renderer test:    [33m[2mÎ“Â£Ã´[22m[39m App component[2m > [22mallows pausing and resuming listening while disconnecting realtime sessions [33m 420[2mms[22m[39m
app/renderer test:    [33m[2mÎ“Â£Ã´[22m[39m App component[2m > [22mupdates realtime api key via configuration form [33m 624[2mms[22m[39m
app/renderer test:    [33m[2mÎ“Â£Ã´[22m[39m App component[2m > [22muses the latest preload bridge when submitting a secret before the hook state updates [33m 886[2mms[22m[39m
app/renderer test:    [33m[2mÎ“Â£Ã´[22m[39m App component[2m > [22mreports wake word access key test failures [33m 709[2mms[22m[39m
app/renderer test:    [33m[2mÎ“Â£Ã´[22m[39m App component[2m > [22msyncs the base prompt textarea with realtime session updates [33m 575[2mms[22m[39m
app/renderer test:    [33m[2mÎ“Â£Ã´[22m[39m App component[2m > [22mlogs realtime disconnect and reconnect when voice preference changes [33m 837[2mms[22m[39m
app/renderer test: [2m Test Files [22m [1m[32m13 passed[39m[22m[90m (13)[39m
app/renderer test: [2m      Tests [22m [1m[32m64 passed[39m[22m[90m (64)[39m
app/renderer test: [2m   Start at [22m 21:53:14
app/renderer test: [2m   Duration [22m 18.10s[2m (transform 3.52s, setup 7.35s, collect 9.71s, tests 13.31s, environment 52.50s, prepare 6.85s)[22m
app/renderer test: Done
app/main test: Failed
C:\Users\kevin\repos\aiembodied\app\main:
Î“Ã‡Ã«ERR_PNPM_RECURSIVE_RUN_FIRST_FAILÎ“Ã‡Ã« @aiembodied/main@0.0.1 test: `npm run test:rebuild && node scripts/test-split.mjs`
Exit status 1
Î“Ã‡Ã«ELIFECYCLEÎ“Ã‡Ã« Test failed. See above for more details.
